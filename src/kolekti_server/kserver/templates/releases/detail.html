{% extends "base.html" %}
{% block current_releases %}class="menu-current"{% endblock %}
{% load statustags %}
{% block extracss %}
    <link rel="stylesheet" type="text/css"  href="/static/css/kolekti-releases.css"></script>
    <link rel="stylesheet" type="text/css"  href="/criteria.css"></script>
<!--    <script src="/static/ckeditor/ckeditor.js"></script> -->
{% endblock %}

{% block extrascripts %}
    <script src="/static/js/kolekti-release.js"></script>
{% endblock %}

    {% block title %}
    {{ assembly_name }}
    {% endblock %}


{% block infobuttons_lang %}
    {% comment %}
    {% for rlang, state in langstates %}
    <div class="btn-group" role="group">
      {% if  state == "unknown" %}
      <button class="btn btn-xs btn-default btn-lang-menu-{{ rlang }}  btn-lang-copy"
	      type="button"
	      data-state="{{ state }}"
	      data-lang="{{ rlang }}"
	      title="Créer la version {{ rlang }}">
	
	<span class="state">{{ rlang }}</span>
      </button>
      {% else %}
      <button class="btn btn-xs {% if rlang == lang %}btn-primary{% else %}btn-default btn-lang{% endif %} btn-lang-{{ rlang }}"
	      data-lang="{{ rlang }}"
	      type="button">
	<strong>{{ rlang }}</strong
      </button>
      <button class="btn btn-xs btn-default btn-lang-menu-{{ rlang }} btn-lang-menu-{{ state }} btn-lang-menu dropdown-toggle" type="button"
	      title="{{ state }}"
	      data-lang="{{ rlang }}"
	      data-state="{{ state }}" 
	      data-toggle="dropdown"
	      aria-expanded="true">
	<span class="state"><img src="/static/img/release_status_{{state}}.png"/></span>
	<span class="caret"/>
      </button>
      <ul class="dropdown-menu" role="menu" data-target-lang="{{ rlang }}">
	<li><a class="release-state" data-state="edition" href="#" >Mise à jour</a></li>
	<li><a class="release-state" data-state="translation" href="#"><span class="text-primary">Traduction en cours</span></a></li>
	<li><a class="release-state" data-state="validation" href="#"><span class="text-warning">Controle</a></li>
	<li><a class="release-state" data-state="publication" href="#"><span class="text-success">Bon pour publication</a></li>
      </ul>
      {% endif %}
    </div>
    {% endfor %}
{% endcomment %}
    {% endblock %}	      

{% block menu %}
    <div class="row">
      <div class="col-sm-12 col-md-12">
	<div class="btn-group btn-group-justified" role="group">
	  <div class="btn-group" role="group">
	    <button type="button" class="btn btn-primary btn_publish" id="btn_publish">Publier {{lang}}</button>
	  </div>
	  <div class="btn-group" role="group">
	    <button type="button" class="btn btn-primary btn_publish" id="btn_publish_all">Publier BAT </button>
	  </div>
	</div>
      </div>
    </div>

    <br/>

    <div class="panel panel-default hidden">
      <div class="panel-heading">
	<h4 class="panel-title">
	  <a data-toggle="collapse" href="#collapsePL" class="collapsed">
	    <small>
	      <span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span>
	      <span class="glyphicon glyphicon-chevron-down" aria-hidden="false"></span>
	    </small>
	    Publier plusieurs langues
	  </a>
	</h4>
      </div>
      <div id="collapsePL" class="panel-collapse collapse on">
	<div class="panel-body">
	  <div class="row">
	    <div class="col-sm-6 col-md-6">
	      <div class="checkbox">
		<label>
		  <input type="checkbox" class="publangs" name="pl_lang" value ="all" id="pl_all"/>
		  Toutes
		</label>
	      </div>
	    </div>
	    <div class="col-sm-6 col-md-6">
	      <div class="checkbox">
		<label>
		  <input type="checkbox" class="publangs" name="pl_lang" value ="none" id="pl_none"/>
		  Aucune
		</label>
	      </div>
	    </div>
	  </div>
	  <div class="row">
	    {% for lang in langs %}
	    <div class="col-sm-12 col-md-4">
	      <div class="checkbox">
		<label>
		  <input type="checkbox" class="publangs" name="pl_lang" value ="{{lang.code}}" id="pl_{{lang.code}}"/>
		  {{ lang.code }}
		</label>
	      </div>
	    </div>
	    {% endfor %} 
	  </div>
	  <div class="row">
	    <div class="col-sm-6 col-md-6">
	      <button type="button" class="btn btn-block btn-primary btn_publish" id="btn_publish">Publier</button>
	    </div>
	  </div>
	</div> <!-- panel body -->
      </div>
    </div>



    <div class="panel panel-default">
      <div class="panel-heading">
	<h4 class="panel-title">
	  <a data-toggle="collapse" href="#collapseAS" class="collapsed">
	    <small>
	      <span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span>
	      <span class="glyphicon glyphicon-chevron-down" aria-hidden="false"></span>
	    </small>
	    Assemblage
	  </a>
	</h4>
      </div>
      <div id="collapseAS" class="panel-collapse collapse">
	<div class="panel-body">
	  <div class="row">
	    <div class="col-sm-6 col-md-6">
	      <button type="button" class="btn btn-block btn-default btn_export" id="btn_export">Export</button>
	    </div>
	    <div class="col-sm-6 col-md-6">
	      <button type="button" class="btn btn-block btn-default btn_import" id="btn_import">Import</button>
	    </div>
	  </div>
	</div>
      </div>
    </div>



    <div class="panel panel-default">
      <div class="panel-heading">
	<h4 class="panel-title">
	  <a data-toggle="collapse" href="#collapsePU" class="collapsed">
	    <small>
	      <span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span>
	      <span class="glyphicon glyphicon-chevron-down" aria-hidden="false"></span>
	    </small>
	    Dernières publications
	  </a>
	</h4>
      </div>

      <div id="collapsePU" class="panel-collapse collapse">
	<div class="panel-body">
	  {% include "publication.html" %}
	  {#    <button class="btn btn-default btn-block" data-pubname="{{ pj.pubname }}">Republier</button>  #}
	</div>
      </div>
    </div>


{% endblock %}

{% block content %}
    <div id="main" class="release" data-release="{{release_path}}/{{assembly_name}}" data-lang="{{ lang }}">
      <ul class="nav nav-tabs" role="tablist" id="release_tabs">
	{% for rlang, state,focus in langstates %}
	<li role="presentation"{% if rlang == lang %} class="active"{% endif %}>
	  <a href="#release_content_{{ rlang }}" aria-controls="release_content_ {{ rlang }}"
	     role="tab"
	     data-toggle="tab"
	     data-state="{{ state }}"
	     data-lang="{{ rlang }}"
	     {% if  state == "unknown" %}
	     title="Créer la version {{ rlang }}"
	     {% endif %}
	     >
	    <span class="state lead">{{ rlang }}</span>
	    <br>
	    <span class="state"><img src="/static/img/release_status_{{state}}.png"/></span>
	  </a>
	</li>
	{% endfor %}
      </ul>
      <!-- Tab panes -->

      <div class="tab-content ">
	{% for rlang, state, focus in langstates %}
	<div role="tabpanel" class="tab-pane tab-lang{% if rlang == lang %} active{% endif %}" id="release_content_{{ rlang }}" data-lang="{{ rlang}}">
	  {% if state == "unknown" %}

	  <div class="panel panel-info">
	    <div class="panel-heading">
	      
	      <p>Cette version n'existe pas pour cette langue, veuillez sélectionner la langue à partir de laquelle la nouvelle version doit être créée</p>
	      <select name="release_copy_from_lang">
		{% for mrlang, mstate in langstates %}
		<option value="{{ mrlang }}">{{ mrlang }}</option>
		{% endfor %}
	      </select>
	      <input type="hidden" name="release_lang" value="{{ lang }}"/>
	    </div>
	  </div>
	  
	  {% else %}
	  
	  <div class="panel panel-infodefault">
	    <div class="panel-body">
	      Statut :
	      <div class="btn-group">
	      	<button class="btn btn-default btn-lang-menu-{{ rlang }} btn-lang-menu-{{ state }} btn-lang-menu dropdown-toggle" type="button"
			title="{{ state }}"
			data-lang="{{ rlang }}"
			data-state="{{ state }}" 
			data-toggle="dropdown"
			aria-expanded="true">
		  <span class="state">{{state|statustext}}</span>
		  <span class="caret"/>
		</button>
		<ul class="dropdown-menu" role="menu" data-target-lang="{{ rlang }}">
		  <li><a class="release-state" data-state="edition" href="#" >Nouveau</a></li>
		  <li><a class="release-state" data-state="translation" href="#"><span class="text-primary">En traduction</span></a></li>
		  <li><a class="release-state" data-state="validation" href="#"><span class="text-warning">En relecture</a></li>
		  <li><a class="release-state" data-state="publication" href="#"><span class="text-success">Officialisé</a></li>
		</ul>
	      </div>
	      
	      <input type="checkbox" id="focus_{{ lang }}">Focus</input>
	    </div>
	  </div>
	  
	  <div id="content_{{ rlang }}">
	  </div>
	  {% endif %}
	  
	</div>

 	{% endfor %}
   </div>



    {% comment %}
	  {% if  state == "unknown" %}
	<button class="btn btn-xs btn-default btn-lang-menu-{{ rlang }}  btn-lang-copy"
		type="button"
		data-state="{{ state }}"
		data-lang="{{ rlang }}"
		title="Créer la version {{ rlang }}">
	  
	  <span class="state">{{ rlang }}</span>
	</button>
	{% else %}
	<button class="btn btn-xs {% if rlang == lang %}btn-primary{% else %}btn-default btn-lang{% endif %} btn-lang-{{ rlang }}"
		data-lang="{{ rlang }}"
		type="button">
	  <strong>{{ rlang }}</strong
				</button>
	<button class="btn btn-xs btn-default btn-lang-menu-{{ rlang }} btn-lang-menu-{{ state }} btn-lang-menu dropdown-toggle" type="button"
		title="{{ state }}"
		data-lang="{{ rlang }}"
		data-state="{{ state }}" 
		data-toggle="dropdown"
		aria-expanded="true">
	  <span class="state"><img src="/static/img/release_status_{{state}}.png"/></span>
	  <span class="caret"/>
	</button>
	<ul class="dropdown-menu" role="menu" data-target-lang="{{ rlang }}">
	  <li><a class="release-state" data-state="edition" href="#" >Mise à jour</a></li>
	  <li><a class="release-state" data-state="translation" href="#"><span class="text-primary">Traduction en cours</span></a></li>
	  <li><a class="release-state" data-state="validation" href="#"><span class="text-warning">Controle</a></li>
	  <li><a class="release-state" data-state="publication" href="#"><span class="text-success">Bon pour publication</a></li>
	</ul>
	{% endif %}

</div>

      {% endfor %}
{% endcomment %}

{% comment %}
	{{ content |safe }}
  <!--
    <form method="POST">
      <textarea name="editor1" id="editor1" rows="100" cols="80">
	{{ content |safe }}
      </textarea>
    </form>
 -->
  {% endcomment %}
</div>
{% endblock %}



{% block modal-body %}
{% endblock %}

{% block modal-title %}Dupliquer une version{% endblock %}

{% block modal-footer %}
<button type="submit"  class="btn btn-primary">Valider</button>
{% endblock %}
