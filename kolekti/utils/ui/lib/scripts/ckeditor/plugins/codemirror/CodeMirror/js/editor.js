var internetExplorer=document.selection&&window.ActiveXObject&&/MSIE/.test(navigator.userAgent),oldIE=internetExplorer&&/MSIE\s+[4-8]\b/.test(navigator.userAgent),webkit=/AppleWebKit/.test(navigator.userAgent),safari=/Apple Computer, Inc/.test(navigator.vendor),gecko=navigator.userAgent.match(/gecko\/(\d{8})/i);if(gecko)gecko=Number(gecko[1]);var mac=/Mac/.test(navigator.platform),brokenOpera=window.opera&&/Version\/10.[56]/.test(navigator.userAgent),slowWebkit=/AppleWebKit\/533/.test(navigator.userAgent);function makeWhiteSpace(q){var r=[],s=true;for(;q>0;q--){r.push(s||q==1?nbsp:' ');s^=true;}return r.join('');};function fixSpaces(q){if(q.charAt(0)==' ')q=nbsp+q.slice(1);return q.replace(/\t/g,function(){return makeWhiteSpace(indentUnit);}).replace(/[ \u00a0]{2,}/g,function(r){return makeWhiteSpace(r.length);});};function cleanText(q){return q.replace(/\u00a0/g,' ').replace(/\u200b/g,'');};function makePartSpan(q){var r=q;if(q.nodeType==3)r=q.nodeValue;else q=document.createTextNode(r);var s=document.createElement('span');s.isPart=true;s.appendChild(q);s.currentText=r;return s;};function alwaysZero(){return 0;};var webkitLastLineHack=webkit?function(q){var r=q.lastChild;if(!r||!r.hackBR){var s=document.createElement('br');s.hackBR=true;q.appendChild(s);}}:function(){};function asEditorLines(q){var r=makeWhiteSpace(indentUnit);return map(q.replace(/\t/g,r).replace(/\u00a0/g,' ').replace(/\r\n?/g,'\n').split('\n'),fixSpaces);};var Editor=(function(){var q={P:true,DIV:true,LI:true};function r(A,B){var C=[],D=true;function E(F,G){if(F.nodeType==3){var H=F.nodeValue=fixSpaces(F.nodeValue.replace(/[\r\u200b]/g,'').replace(/\n/g,' '));if(H.length)D=false;C.push(F);}else if(isBR(F)&&F.childNodes.length==0){D=true;C.push(F);}else{for(var I=F.firstChild;I;I=I.nextSibling)E(I);if(!D&&q.hasOwnProperty(F.nodeName.toUpperCase())){D=true;if(!B||!G)C.push(document.createElement('br'));}}};E(A,true);return C;};function s(A){var B=[];function C(J){var K=J.parentNode,L=J.nextSibling;return function(M){K.insertBefore(M,L);};};var D=null,E=true;function F(J){var K='\n';if(J.nodeType==3){select.snapshotChanged();J=makePartSpan(J);K=J.currentText;E=false;}else{if(E&&window.opera)D(makePartSpan(''));E=true;}J.dirty=true;B.push(J);D(J);return K;};function G(J,K){var L=r(J,K);for(var M=0;M<L.length;M++)L[M]=F(L[M]);return L.join('');};function H(J){if(J.isPart&&J.childNodes.length==1&&J.firstChild.nodeType==3){var K=J.firstChild.nodeValue;J.dirty=J.dirty||K!=J.currentText;J.currentText=K;
return!/[\n\t\r]/.test(J.currentText);}return false;};function I(){if(!A)throw StopIteration;var J=A;A=J.nextSibling;if(H(J)){B.push(J);E=false;return J.currentText;}else if(isBR(J)){if(E&&window.opera)J.parentNode.insertBefore(makePartSpan(''),J);B.push(J);E=true;return '\n';}else{var K=!J.nextSibling;D=C(J);removeElement(J);return G(J,K);}};return{next:I,nodes:B};};function t(A){return isBR(A)?1:A.currentText.length;};function u(A){while(A&&!isBR(A))A=A.previousSibling;return A;};function v(A,B){if(!A)A=B.firstChild;else if(isBR(A))A=A.nextSibling;while(A&&!isBR(A))A=A.nextSibling;return A;};function w(){return new Date().getTime();};function x(A,B,C,D){this.editor=A;this.history=A.history;this.history.commit();this.valid=!!B;this.atOccurrence=false;if(D==undefined)D=typeof B=='string'&&B==B.toLowerCase();function E(J){var K=cleanText(A.history.textAfter(J));return D?K.toLowerCase():K;};var F={node:null,offset:0},G=this;if(C&&typeof C=='object'&&typeof C.character=='number'){A.checkLine(C.line);var H={node:C.line,offset:C.character};this.pos={from:H,to:H};}else if(C)this.pos={from:select.cursorPos(A.container,true)||F,to:select.cursorPos(A.container,false)||F};else this.pos={from:F,to:F};if(typeof B!='string'){this.matches=function(J,K,L){if(J){var M=E(K).slice(0,L),N=M.match(B),O=0;while(N){var P=M.indexOf(N[0]);O+=P;M=M.slice(P+1);var Q=M.match(B);if(Q)N=Q;else break;}}else var M=E(K).slice(L),N=M.match(B),O=N&&L+M.indexOf(N[0]);if(N){G.currentMatch=N;return{from:{node:K,offset:O},to:{node:K,offset:O+N[0].length}};}};return;}if(D)B=B.toLowerCase();var I=B.split('\n');this.matches=I.length==1?function(J,K,L){var M=E(K),N=B.length,O;if(J?L>=N&&(O=M.lastIndexOf(B,L-N))!=-1:(O=M.indexOf(B,L))!=-1)return{from:{node:K,offset:O},to:{node:K,offset:O+N}};}:function(J,K,L){var M=J?I.length-1:0,N=I[M],O=E(K),P=J?O.indexOf(N)+N.length:O.lastIndexOf(N);if(J?P>=L||P!=N.length:P<=L||P!=O.length-N.length)return;var Q=K;for(;;){if(J&&!Q)return;Q=J?this.history.nodeBefore(Q):this.history.nodeAfter(Q);if(!J&&!Q)return;O=E(Q);N=I[J?--M:++M];if(M>0&&M<I.length-1){if(O!=N)return;else continue;}var R=J?O.lastIndexOf(N):O.indexOf(N)+N.length;if(J?R!=O.length-N.length:R!=N.length)return;return{from:{node:J?Q:K,offset:J?R:P},to:{node:J?K:Q,offset:J?P:R}};}};};x.prototype={findNext:function(){return this.find(false);},findPrevious:function(){return this.find(true);},find:function(A){if(!this.valid)return false;var B=this,C=A?this.pos.from:this.pos.to,D=C.node,E=C.offset;if(D&&!D.parentNode){D=null;
E=0;}function F(){var H={node:D,offset:E};B.pos={from:H,to:H};B.atOccurrence=false;return false;};for(;;){if(this.pos=this.matches(A,D,E)){this.atOccurrence=true;return true;}if(A){if(!D)return F();D=this.history.nodeBefore(D);E=this.history.textAfter(D).length;}else{var G=this.history.nodeAfter(D);if(!G){E=this.history.textAfter(D).length;return F();}D=G;E=0;}}},select:function(){var A=this;if(A.atOccurrence){select.setCursorPos(A.editor.container,A.pos.from,A.pos.to);select.scrollToCursor(A.editor.container);}},replace:function(A){if(this.atOccurrence){var B=this.currentMatch;if(B)A=A.replace(/\\(\d)/,function(D,E){return B[E];});var C=this.editor.replaceRange(this.pos.from,this.pos.to,A);this.pos.to=C;this.atOccurrence=false;}},position:function(){if(this.atOccurrence)return{line:this.pos.from.node,character:this.pos.from.offset};}};function y(A){this.options=A;window.indentUnit=A.indentUnit;var B=this.container=document.body;this.history=new UndoHistory(B,A.undoDepth,A.undoDelay,this);var C=this;if(!y.Parser)throw 'No parser loaded.';if(A.parserConfig&&y.Parser.configure)y.Parser.configure(A.parserConfig);if(!A.readOnly&&!internetExplorer)select.setCursorPos(B,{node:null,offset:0});this.dirty=[];this.importCode(A.content||'');this.history.onChange=A.onChange;if(!A.readOnly){if(A.continuousScanning!==false){this.scanner=this.documentScanner(A.passTime);this.delayScanning();}function D(){if(document.body.contentEditable!=undefined&&internetExplorer)document.body.contentEditable='true';else document.designMode='on';if(internetExplorer&&A.height!='dynamic')document.body.style.minHeight=window.frameElement.clientHeight-2*document.body.offsetTop-5+'px';document.documentElement.style.borderWidth='0';if(!A.textWrapping)B.style.whiteSpace='nowrap';};try{D();}catch(G){var E=addEventHandler(document,'focus',function(){E();D();},true);}addEventHandler(document,'keydown',method(this,'keyDown'));addEventHandler(document,'keypress',method(this,'keyPress'));addEventHandler(document,'keyup',method(this,'keyUp'));function F(){C.cursorActivity(false);};addEventHandler(internetExplorer?document.body:window,'mouseup',F);addEventHandler(document.body,'cut',F);if(gecko)addEventHandler(window,'pagehide',function(){C.unloaded=true;});addEventHandler(document.body,'paste',function(H){F();var I=null;try{var J=H.clipboardData||window.clipboardData;if(J)I=J.getData('Text');}catch(K){}if(I!==null){H.stop();C.replaceSelection(I);select.scrollToCursor(C.container);}});if(this.options.autoMatchParens)addEventHandler(document.body,'click',method(this,'scheduleParenHighlight'));
}else if(!A.textWrapping)B.style.whiteSpace='nowrap';};function z(A){return A>=16&&A<=18||A>=33&&A<=40;};y.prototype={importCode:function(A){var B=asEditorLines(A),C=1000;if(!this.options.incrementalLoading||B.length<C){this.history.push(null,null,B);this.history.reset();}else{var D=0,E=this;function F(){var G=B.slice(D,D+C);G.push('');E.history.push(E.history.nodeBefore(null),null,G);E.history.reset();D+=C;if(D<B.length)parent.setTimeout(F,1000);};F();}},getCode:function(){var A=this;if(!A.container.firstChild)return '';var B=[];select.markSelection();forEach(s(A.container.firstChild),method(B,'push'));select.selectMarked();if(webkit&&A.container.lastChild.hackBR)B.pop();webkitLastLineHack(A.container);return cleanText(B.join(''));},checkLine:function(A){if(A===false||!(A==null||A.parentNode==this.container||A.hackBR))throw parent.CodeMirror.InvalidLineHandle;},cursorPosition:function(A){if(A==null)A=true;var B=select.cursorPos(this.container,A);if(B)return{line:B.node,character:B.offset};else return{line:null,character:0};},firstLine:function(){return null;},lastLine:function(){var A=this.container.lastChild;if(A)A=u(A);if(A&&A.hackBR)A=u(A.previousSibling);return A;},nextLine:function(A){this.checkLine(A);var B=v(A,this.container);if(!B||B.hackBR)return false;else return B;},prevLine:function(A){this.checkLine(A);if(A==null)return false;return u(A.previousSibling);},visibleLineCount:function(){var A=this.container.firstChild;while(A&&isBR(A))A=A.nextSibling;if(!A)return false;var B=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight;return Math.floor(B/A.offsetHeight);},selectLines:function(A,B,C,D){var E=this;E.checkLine(A);var F={node:A,offset:B},G=null;if(D!==undefined){E.checkLine(C);G={node:C,offset:D};}select.setCursorPos(E.container,F,G);select.scrollToCursor(E.container);},lineContent:function(A){var B=[];for(A=A?A.nextSibling:this.container.firstChild;A&&!isBR(A);A=A.nextSibling)B.push(nodeText(A));return cleanText(B.join(''));},setLineContent:function(A,B){var C=this;C.history.commit();C.replaceRange({node:A,offset:0},{node:A,offset:C.history.textAfter(A).length},B);C.addDirtyNode(A);C.scheduleHighlight();},removeLine:function(A){var B=A?A.nextSibling:this.container.firstChild;while(B){var C=B.nextSibling;removeElement(B);if(isBR(B))break;B=C;}this.addDirtyNode(A);this.scheduleHighlight();},insertIntoLine:function(A,B,C){var D=this,E=null;if(B=='end')E=v(A,D.container);else for(var F=A?A.nextSibling:D.container.firstChild;
F;F=F.nextSibling){if(B==0){E=F;break;}var G=nodeText(F);if(G.length>B){E=F.nextSibling;C=G.slice(0,B)+C+G.slice(B);removeElement(F);break;}B-=G.length;}var H=asEditorLines(C);for(var I=0;I<H.length;I++){if(I>0)D.container.insertBefore(document.createElement('BR'),E);D.container.insertBefore(makePartSpan(H[I]),E);}D.addDirtyNode(A);D.scheduleHighlight();},selectedText:function(){var A=this.history;A.commit();var B=select.cursorPos(this.container,true),C=select.cursorPos(this.container,false);if(!B||!C)return '';if(B.node==C.node)return A.textAfter(B.node).slice(B.offset,C.offset);var D=[A.textAfter(B.node).slice(B.offset)];for(var E=A.nodeAfter(B.node);E!=C.node;E=A.nodeAfter(E))D.push(A.textAfter(E));D.push(A.textAfter(C.node).slice(0,C.offset));return cleanText(D.join('\n'));},replaceSelection:function(A){var B=this;B.history.commit();var C=select.cursorPos(B.container,true),D=select.cursorPos(B.container,false);if(!C||!D)return;D=B.replaceRange(C,D,A);select.setCursorPos(B.container,D);webkitLastLineHack(B.container);},cursorCoords:function(A,B){var C=select.cursorPos(this.container,A);if(!C)return null;var D=C.offset,E=C.node,F=this;function G(J,K){var L=-(document.body.scrollTop||document.documentElement.scrollTop||0),M=-(document.body.scrollLeft||document.documentElement.scrollLeft||0)+K;forEach([J,B?null:window.frameElement],function(N){while(N){M+=N.offsetLeft;L+=N.offsetTop;N=N.offsetParent;}});return{x:M,y:L,yBot:L+J.offsetHeight};};function H(J,K){var L=document.createElement('SPAN');L.appendChild(document.createTextNode(J));try{return K(L);}finally{if(L.parentNode)L.parentNode.removeChild(L);}};while(D){E=E?E.nextSibling:this.container.firstChild;var I=nodeText(E);if(D<I.length)return H(I.substr(0,D),function(J){J.style.position='absolute';J.style.visibility='hidden';J.className=E.className;F.container.appendChild(J);return G(E,J.offsetWidth);});D-=I.length;}if(E&&isSpan(E))return G(E,E.offsetWidth);else if(E&&E.nextSibling&&isSpan(E.nextSibling))return G(E.nextSibling,0);else return H('​',function(J){if(E)E.parentNode.insertBefore(J,E.nextSibling);else F.container.insertBefore(J,F.container.firstChild);return G(J,0);});},reroutePasteEvent:function(){if(this.capturingPaste||window.opera||gecko&&gecko>=20101026)return;this.capturingPaste=true;var A=window.frameElement.CodeMirror.textareaHack,B=this.cursorCoords(true,true);A.style.top=B.y+'px';if(oldIE){var C=select.getBookmark(this.container);if(C)this.selectionSnapshot=C;}parent.focus();A.value='';
A.focus();var D=this;parent.setTimeout(function(){D.capturingPaste=false;window.focus();if(D.selectionSnapshot)window.select.setBookmark(D.container,D.selectionSnapshot);var E=A.value;if(E){D.replaceSelection(E);select.scrollToCursor(D.container);}},10);},replaceRange:function(A,B,C){var D=this,E=asEditorLines(C);E[0]=D.history.textAfter(A.node).slice(0,A.offset)+E[0];var F=E[E.length-1];E[E.length-1]=F+D.history.textAfter(B.node).slice(B.offset);var G=D.history.nodeAfter(B.node);D.history.push(A.node,G,E);return{node:D.history.nodeBefore(G),offset:F.length};},getSearchCursor:function(A,B,C){return new x(this,A,B,C);},reindent:function(){if(this.container.firstChild)this.indentRegion(null,this.container.lastChild);},reindentSelection:function(A){var B=this;if(!select.somethingSelected())B.indentAtCursor(A);else{var C=select.selectionTopNode(B.container,true),D=select.selectionTopNode(B.container,false);if(C===false||D===false)return;B.indentRegion(C,D,A,true);}},grabKeys:function(A,B){this.frozen=A;this.keyFilter=B;},ungrabKeys:function(){this.frozen='leave';},setParser:function(A,B){y.Parser=window[A];B=B||this.options.parserConfig;if(B&&y.Parser.configure)y.Parser.configure(B);if(this.container.firstChild){forEach(this.container.childNodes,function(C){if(C.nodeType!=3)C.dirty=true;});this.addDirtyNode(this.firstChild);this.scheduleHighlight();}},keyDown:function(A){var B=this;if(B.frozen=='leave'){B.frozen=null;B.keyFilter=null;}if(B.frozen&&(!B.keyFilter||B.keyFilter(A.keyCode,A))){A.stop();B.frozen(A);return;}var C=A.keyCode;B.delayScanning();if(B.options.autoMatchParens)B.scheduleParenHighlight();if(C==13){if(A.ctrlKey&&!A.altKey)B.reparseBuffer();else{select.insertNewlineAtCursor();var D=B.options.enterMode;if(D!='flat')B.indentAtCursor(D=='keep'?'keep':undefined);select.scrollToCursor(B.container);}A.stop();}else if(C==9&&B.options.tabMode!='default'&&!A.ctrlKey){B.handleTab(!A.shiftKey);A.stop();}else if(C==32&&A.shiftKey&&B.options.tabMode=='default'){B.handleTab(true);A.stop();}else if(C==36&&!A.shiftKey&&!A.ctrlKey){if(B.home())A.stop();}else if(C==35&&!A.shiftKey&&!A.ctrlKey){if(B.end())A.stop();}else if(C==33&&!A.shiftKey&&!A.ctrlKey&&!gecko){if(B.pageUp())A.stop();}else if(C==34&&!A.shiftKey&&!A.ctrlKey&&!gecko){if(B.pageDown())A.stop();}else if((C==219||C==221)&&A.ctrlKey&&!A.altKey){B.highlightParens(A.shiftKey,true);A.stop();}else if(A.metaKey&&!A.shiftKey&&(C==37||C==39)){var E=select.selectionTopNode(B.container);if(E===false||!B.container.firstChild)return;
if(C==37)select.focusAfterNode(u(E),B.container);else{var F=v(E,B.container);select.focusAfterNode(F?F.previousSibling:B.container.lastChild,B.container);}A.stop();}else if((A.ctrlKey||A.metaKey)&&!A.altKey){if(A.shiftKey&&C==90||C==89){select.scrollToNode(B.history.redo());A.stop();}else if(C==90||safari&&C==8){select.scrollToNode(B.history.undo());A.stop();}else if(C==83&&B.options.saveFunction){B.options.saveFunction();A.stop();}else if(C==86&&!mac)B.reroutePasteEvent();}},keyPress:function(A){var B=this.options.electricChars&&y.Parser.electricChars,C=this;if(this.frozen&&(!this.keyFilter||this.keyFilter(A.keyCode||A.code,A))||A.code==13||A.code==9&&this.options.tabMode!='default'||A.code==32&&A.shiftKey&&this.options.tabMode=='default')A.stop();else if(mac&&(A.ctrlKey||A.metaKey)&&A.character=='v')this.reroutePasteEvent();else if(B&&B.indexOf(A.character)!=-1)parent.setTimeout(function(){C.indentAtCursor(null);},0);else if(brokenOpera){if(A.code==8){var D=select.selectionTopNode(this.container),C=this,E=D?D.nextSibling:this.container.firstChild;if(D!==false&&E&&isBR(E))parent.setTimeout(function(){if(select.selectionTopNode(C.container)==E)select.focusAfterNode(E.previousSibling,C.container);},20);}else if(A.code==46){var D=select.selectionTopNode(this.container),C=this;if(D&&isBR(D))parent.setTimeout(function(){if(select.selectionTopNode(C.container)!=D)select.focusAfterNode(D,C.container);},20);}}else if(slowWebkit){var D=select.selectionTopNode(this.container),E=D?D.nextSibling:this.container.firstChild;if(D&&E&&isBR(E)&&!isBR(D)){var F=document.createTextNode('​');this.container.insertBefore(F,E);parent.setTimeout(function(){if(F.nodeValue=='​')removeElement(F);else F.nodeValue=F.nodeValue.replace('​','');},20);}}if(webkit&&!this.options.textWrapping)setTimeout(function(){var G=select.selectionTopNode(C.container,true);if(G&&G.nodeType==3&&G.previousSibling&&isBR(G.previousSibling)&&G.nextSibling&&isBR(G.nextSibling))G.parentNode.replaceChild(document.createElement('BR'),G.previousSibling);},50);},keyUp:function(A){this.cursorActivity(z(A.keyCode));},indentLineAfter:function(A,B){function C(L){var M=L?L.nextSibling:D.container.firstChild;if(!M||!hasClass(M,'whitespace'))return null;return M;};var D=this,E=C(A),F=0,G=E?E.currentText.length:0,H=E?E.nextSibling:A?A.nextSibling:this.container.firstChild;if(B=='keep'){if(A){var I=C(u(A.previousSibling));if(I)F=I.currentText.length;}}else{var J=A&&H&&H.currentText?H.currentText:'';if(B!=null&&this.options.tabMode!='indent')F=B?G+indentUnit:Math.max(0,G-indentUnit);
else if(A)F=A.indentation(J,G,B,H);else if(y.Parser.firstIndentation)F=y.Parser.firstIndentation(J,G,B,H);}var K=F-G;if(K<0){if(F==0){if(H)select.snapshotMove(E.firstChild,H.firstChild||H,0);removeElement(E);E=null;}else{select.snapshotMove(E.firstChild,E.firstChild,K,true);E.currentText=makeWhiteSpace(F);E.firstChild.nodeValue=E.currentText;}}else if(K>0){if(E){E.currentText=makeWhiteSpace(F);E.firstChild.nodeValue=E.currentText;select.snapshotMove(E.firstChild,E.firstChild,K,true);}else{E=makePartSpan(makeWhiteSpace(F));E.className='whitespace';if(A)insertAfter(E,A);else this.container.insertBefore(E,this.container.firstChild);select.snapshotMove(H&&(H.firstChild||H),E.firstChild,F,false,true);}}else if(E)select.snapshotMove(E.firstChild,E.firstChild,F,false);if(K!=0)this.addDirtyNode(A);},highlightAtCursor:function(){var A=this,B=select.selectionTopNode(A.container,true),C=select.selectionTopNode(A.container,false);if(B===false||C===false)return false;select.markSelection();if(A.highlight(B,v(C,A.container),true,20)===false)return false;select.selectMarked();return true;},handleTab:function(A){if(this.options.tabMode=='spaces'&&!select.somethingSelected())select.insertTabAtCursor();else this.reindentSelection(A);},home:function(){var A=this,B=select.selectionTopNode(A.container,true),C=B;if(B===false||!(!B||B.isPart||isBR(B))||!A.container.firstChild)return false;while(B&&!isBR(B))B=B.previousSibling;var D=B?B.nextSibling:A.container.firstChild;if(D&&D!=C&&D.isPart&&hasClass(D,'whitespace'))select.focusAfterNode(D,A.container);else select.focusAfterNode(B,A.container);select.scrollToCursor(A.container);return true;},end:function(){var A=this,B=select.selectionTopNode(A.container,true);if(B===false)return false;B=v(B,A.container);if(!B)return false;select.focusAfterNode(B.previousSibling,A.container);select.scrollToCursor(A.container);return true;},pageUp:function(){var A=this,B=A.cursorPosition().line,C=A.visibleLineCount();if(B===false||C===false)return false;C-=2;for(var D=0;D<C;D++){B=A.prevLine(B);if(B===false)break;}if(D==0)return false;select.setCursorPos(A.container,{node:B,offset:0});select.scrollToCursor(A.container);return true;},pageDown:function(){var A=this,B=A.cursorPosition().line,C=A.visibleLineCount();if(B===false||C===false)return false;C-=2;for(var D=0;D<C;D++){var E=A.nextLine(B);if(E===false)break;B=E;}if(D==0)return false;select.setCursorPos(A.container,{node:B,offset:0});select.scrollToCursor(A.container);return true;},scheduleParenHighlight:function(){if(this.parenEvent)parent.clearTimeout(this.parenEvent);
var A=this;this.parenEvent=parent.setTimeout(function(){A.highlightParens();},300);},highlightParens:function(A,B){var C=this,D=this.options.markParen;if(typeof D=='string')D=[D,D];function E(P,Q){if(!P)return;if(!D){P.style.fontWeight='bold';P.style.color=Q?'#8F8':'#F88';}else if(D.call)D(P,Q);else P.className+=' '+D[Q?0:1];};function F(P){if(!P)return;if(D&&!D.call)removeClass(removeClass(P,D[0]),D[1]);else if(C.options.unmarkParen)C.options.unmarkParen(P);else{P.style.fontWeight='';P.style.color='';}};if(!B&&C.highlighted){F(C.highlighted[0]);F(C.highlighted[1]);}if(!window||!window.parent||!window.select)return;if(this.parenEvent)parent.clearTimeout(this.parenEvent);this.parenEvent=null;function G(P){if(P.currentText){var Q=P.currentText.match(/^[\s\u00a0]*([\(\)\[\]{}])[\s\u00a0]*$/);return Q&&Q[1];}};function H(P){return/[\(\[\{]/.test(P);};var I,J=select.selectionTopNode(this.container,true);if(!J||!this.highlightAtCursor())return;J=select.selectionTopNode(this.container,true);if(!(J&&((I=G(J))||(J=J.nextSibling)&&(I=G(J)))))return;var K=J.className,L=H(I),M=matching[I];function N(){var P=[],Q,R=true;for(var S=J;S;S=L?S.nextSibling:S.previousSibling){if(S.className==K&&isSpan(S)&&(Q=G(S))){if(H(Q)==L)P.push(Q);else if(!P.length)R=false;else if(P.pop()!=matching[Q])R=false;if(!P.length)break;}else if(S.dirty||!isSpan(S)&&!isBR(S))return{node:S,status:'dirty'};}return{node:S,status:S&&R};};for(;;){var O=N();if(O.status=='dirty'){this.highlight(O.node,v(O.node));O.node.dirty=false;continue;}else{E(J,O.status);E(O.node,O.status);if(B)parent.setTimeout(function(){F(J);F(O.node);},500);else C.highlighted=[J,O.node];if(A&&O.node)select.focusAfterNode(O.node.previousSibling,this.container);break;}}},indentAtCursor:function(A){var B=this;if(!B.container.firstChild)return;if(!B.highlightAtCursor())return;var C=select.selectionTopNode(B.container,false);if(C===false)return;select.markSelection();B.indentLineAfter(u(C),A);select.selectMarked();},indentRegion:function(A,B,C,D){var E=this,F=A=u(A),G=A&&u(A.previousSibling);if(!isBR(B))B=v(B,E.container);E.addDirtyNode(A);do{var H=v(F,E.container);if(F)E.highlight(G,H,true);E.indentLineAfter(F,C);G=F;F=H;}while(F!=B)if(D)select.setCursorPos(E.container,{node:A,offset:0},{node:B,offset:0});},cursorActivity:function(A){if(this.unloaded){window.document.designMode='off';window.document.designMode='on';this.unloaded=false;}if(oldIE){this.container.createTextRange().execCommand('unlink');clearTimeout(this.saveSelectionSnapshot);
var B=this;this.saveSelectionSnapshot=setTimeout(function(){var E=select.getBookmark(B.container);if(E)B.selectionSnapshot=E;},200);}var C=this.options.onCursorActivity;if(!A||C){var D=select.selectionTopNode(this.container,false);if(D===false||!this.container.firstChild)return;D=D||this.container.firstChild;if(C)C(D);if(!A){this.scheduleHighlight();this.addDirtyNode(D);}}},reparseBuffer:function(){forEach(this.container.childNodes,function(A){A.dirty=true;});if(this.container.firstChild)this.addDirtyNode(this.container.firstChild);},addDirtyNode:function(A){var B=this;A=A||B.container.firstChild;if(!A)return;for(var C=0;C<B.dirty.length;C++){if(B.dirty[C]==A)return;}if(A.nodeType!=3)A.dirty=true;B.dirty.push(A);},allClean:function(){return!this.dirty.length;},scheduleHighlight:function(){var A=this;parent.clearTimeout(this.highlightTimeout);this.highlightTimeout=parent.setTimeout(function(){A.highlightDirty();},this.options.passDelay);},getDirtyNode:function(){while(this.dirty.length>0){var A=this.dirty.pop();try{while(A&&A.parentNode!=this.container)A=A.parentNode;if(A&&(A.dirty||A.nodeType==3))return A;}catch(B){}}return null;},highlightDirty:function(A){var B=this;if(!window||!window.parent||!window.select)return false;if(!B.options.readOnly)select.markSelection();var C,D=A?null:w()+B.options.passTime;while((w()<D||A)&&(C=B.getDirtyNode())){var E=B.highlight(C,D);if(E&&E.node&&E.dirty)B.addDirtyNode(E.node.nextSibling);}if(!B.options.readOnly)select.selectMarked();if(C)B.scheduleHighlight();return B.dirty.length==0;},documentScanner:function(A){var B=this,C=null;return function(){if(!window||!window.parent||!window.select)return;if(C&&C.parentNode!=B.container)C=null;select.markSelection();var D=B.highlight(C,w()+A,true);select.selectMarked();var E=D?D.node&&D.node.nextSibling:null;C=C==E?null:E;B.delayScanning();};},delayScanning:function(){var A=this;if(A.scanner){parent.clearTimeout(A.documentScan);A.documentScan=parent.setTimeout(A.scanner,A.options.continuousScanning);}},highlight:function(A,B,C,D){var E=this.container,F=this,G=this.options.activeTokens,H=typeof B=='number'?B:null;if(!E.firstChild)return false;while(A&&(!A.parserFromHere||A.dirty)){if(D!=null&&isBR(A)&&--D<0)return false;A=A.previousSibling;}if(A&&!A.nextSibling)return false;function I(U,V){return!V.reduced&&V.currentText==U.value&&V.className==U.style;};function J(U,V){U.currentText=U.currentText.substring(V);U.reduced=true;};function K(U){var V=makePartSpan(U.value);V.className=U.style;
return V;};function L(U){if(U){var V=U.oldNextSibling;if(R||V===undefined||U.nextSibling!=V)F.history.touch(U);U.oldNextSibling=U.nextSibling;}else{var V=F.container.oldFirstChild;if(R||V===undefined||F.container.firstChild!=V)F.history.touch(null);F.container.oldFirstChild=F.container.firstChild;}};var M=s(A?A.nextSibling:E.firstChild),N=stringStream(M),O=A?A.parserFromHere(N):y.Parser.make(N);function P(U){return(U.previousSibling==null||isBR(U.previousSibling))&&(U.nextSibling==null||isBR(U.nextSibling));};var Q={current:null,get:function(){if(!this.current)this.current=M.nodes.shift();return this.current;},next:function(){this.current=null;},remove:function(){E.removeChild(this.get());this.current=null;},getNonEmpty:function(){var U=this,V=U.get();while(V&&isSpan(V)&&V.currentText==''){if(window.opera&&P(V)){U.next();V=U.get();}else{var W=V;U.remove();V=U.get();select.snapshotMove(W.firstChild,V&&(V.firstChild||V),0);}}return V;}},R=false,S=true,T=0;forEach(O,function(U){var V=Q.getNonEmpty();if(U.value=='\n'){if(!isBR(V))throw 'Parser out of sync. Expected BR.';if(V.dirty||!V.indentation)R=true;L(A);A=V;V.parserFromHere=O.copy();V.indentation=U.indentation||alwaysZero;V.dirty=false;if(H==null&&V==B)throw StopIteration;if(H!=null&&w()>=H||!R&&!S&&T>1&&!C)throw StopIteration;S=R;R=false;T=0;Q.next();}else{if(!isSpan(V))throw 'Parser out of sync. Expected SPAN.';if(V.dirty)R=true;T++;if(I(U,V)){if(G&&V.dirty)G(V,U,F);V.dirty=false;Q.next();}else{R=true;var W=K(U);E.insertBefore(W,V);if(G)G(W,U,F);var X=U.value.length,Y=0;while(X>0){V=Q.get();var Z=V.currentText.length;select.snapshotReplaceNode(V.firstChild,W.firstChild,X,Y);if(Z>X){J(V,X);X=0;}else{X-=Z;Y+=Z;Q.remove();}}}}});L(A);webkitLastLineHack(this.container);return{node:Q.getNonEmpty(),dirty:R};}};return y;})();addEventHandler(window,'load',function(){var q=window.frameElement.CodeMirror,r=q.editor=new Editor(q.options);parent.setTimeout(method(q,'init'),0);});
